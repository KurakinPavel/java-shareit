DROP TABLE IF EXISTS PUBLIC.BOOKINGS;
DROP TABLE IF EXISTS PUBLIC.COMMENTS;
DROP TABLE IF EXISTS PUBLIC.ITEMS;
DROP TABLE IF EXISTS PUBLIC.REQUESTS;
DROP TABLE IF EXISTS PUBLIC.USERS;

CREATE TABLE IF NOT EXISTS PUBLIC.USERS
(
    USER_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME    VARCHAR(255) NOT NULL,
    EMAIL   VARCHAR(512) NOT NULL,
    CONSTRAINT UQ_USER_EMAIL UNIQUE (EMAIL)
);

CREATE TABLE IF NOT EXISTS PUBLIC.REQUESTS
(
    REQUEST_ID   BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DESCRIPTION  VARCHAR(512) NOT NULL,
    REQUESTER_ID BIGINT REFERENCES PUBLIC.USERS (USER_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS PUBLIC.ITEMS
(
    ITEM_ID     BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NAME        VARCHAR(255) NOT NULL,
    DESCRIPTION VARCHAR(512) NOT NULL,
    AVAILABLE   INTEGER NOT NULL,
    OWNER_ID    BIGINT REFERENCES PUBLIC.USERS (USER_ID) ON DELETE CASCADE,
    REQUEST_ID  INTEGER REFERENCES PUBLIC.REQUESTS (REQUEST_ID) ON DELETE CASCADE
);

CREATE TABLE IF NOT EXISTS PUBLIC.BOOKINGS
(
    BOOKING_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    START_DATE TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    END_DATE   TIMESTAMP WITHOUT TIME ZONE NOT NULL,
    ITEM_ID    BIGINT REFERENCES PUBLIC.ITEMS (ITEM_ID) ON DELETE CASCADE,
    BOOKER_ID  INTEGER REFERENCES PUBLIC.USERS (USER_ID) ON DELETE CASCADE,
    STATUS     INTEGER NOT NULL
);

CREATE TABLE IF NOT EXISTS PUBLIC.COMMENTS
(
    COMMENT_ID BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    COMMENT    VARCHAR(1024) NOT NULL,
    ITEM_ID    BIGINT REFERENCES PUBLIC.ITEMS (ITEM_ID) ON DELETE CASCADE,
    AUTHOR_ID  INTEGER REFERENCES PUBLIC.USERS (USER_ID) ON DELETE CASCADE
);
